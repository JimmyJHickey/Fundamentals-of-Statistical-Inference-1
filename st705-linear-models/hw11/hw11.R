# Thank you Qiang!

library(MASS)

X = matrix(c(
 1 , 1 , 0 , 0 , 1 , 0 ,	1	,	0	,	0	,	0	,	0	, 	0,
 1 , 1 , 0 , 0 , 1 , 0 ,	1	,	0	,	0	,	0	,	0	, 	0,
 1 , 1 , 0 , 0 , 0 , 1 ,	0	,	1	,	0	,	0	,	0	, 	0,
 1 , 1 , 0 , 0 , 0 , 1 ,	0	,	1	,	0	,	0	,	0	, 	0,
 1 , 0 , 1 , 0 , 1 , 0 ,	0	,	0	,	1	,	0	,	0	, 	0,
 1 , 0 , 1 , 0 , 1 , 0 ,	0	,	0	,	1	,	0	,	0	, 	0,
 1 , 0 , 1 , 0 , 0 , 1 ,	0	,	0	,	0	,	1	,	0	, 	0,
 1 , 0 , 1 , 0 , 0 , 1 ,	0	,	0	,	0	,	1	,	0	, 	0,
 1 , 0 , 0 , 1 , 1 , 0 ,	0	,	0	,	0	,	0	,	1	, 	0,
 1 , 0 , 0 , 1 , 1 , 0 ,	0	,	0	,	0	,	0	,	1	, 	0,
 1 , 0 , 0 , 1 , 0 , 1 ,	0	,	0	,	0	,	0	,	0	, 	1,
 1 , 0 , 0 , 1 , 0 , 1 ,	0	,	0	,	0	,	0	,	0	, 	1
), byrow=T, ncol=1+3+2+6)

X0 = X[,1:6]

K = matrix(c(
 0 , 0 , 0 , 0 , 0 , 0 , 1 , -1 , -1 , 1 , 0 , 0 ,
 0 , 0 , 0 , 0 , 0 , 0 , 1 , -1 , 0 , 0 , -1 , 1 
), ncol = 2)

PX = X %*% ginv(t(X) %*% X) %*% t(X)
PX0 = X0 %*% ginv(t(X0) %*% X0) %*% t(X0)

quadratic_form1 = PX - PX0

quadratic_form2 = X %*% t(ginv( t(X) %*% X)) %*% K %*% solve(t(K) %*% ginv(t(X) %*% X) %*% K) %*% t(K) %*% ginv(t(X) %*% X) %*% t(X)

mean(abs(quadratic_form1 - quadratic_form2))
# [1] 1.179612e-16